---
layout: post
title: Vim rocks - publish code on Web
date: '2012-11-01T14:43:00.001+01:00'
author: Ondrej Platek
tags:
- Vim
modified_time: '2012-11-01T14:43:19.528+01:00'
blogger_id: tag:blogger.com,1999:blog-1883852367990943689.post-3591067670273225661
blogger_orig_url: http://oplatek.blogspot.com/2012/11/vim-rocks-publish-code-on-web.html
---

How to publish your source code using Vim? Open your source code <pre><br />:TOhtml<br /></pre> and hit enter. It produces html source code of source code. I copied it and pasted here.   Pretty nice, right? I guess gist is to complicated;)  This is just copy paste!  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>~/school/dotplot/dotplot.py.html</title><meta name="Generator" content="Vim/7.3"><meta name="plugin-version" content="vim7.3_v8"><meta name="syntax" content="python"><meta name="settings" content="use_css,expand_tabs"><style type="text/css"><!-- pre { font-family: monospace; color: #000000; background-color: #eeeeee; } body { font-family: monospace; color: #000000; background-color: #eeeeee; } .Constant { color: #ffaf00; } .String { color: #008787; } .Function { color: #af5f87; } .Statement { color: #0000ff; } .PreProc { color: #005fff; } .Comment { color: #87afd7; } --></style></head><body><pre><br /><span class="Comment">#!/usr/bin/env python</span><br /><span class="Comment"># Author: Ondrej Platek 2012; contact:  ondrej.platek at seznam.cz</span><br /><span class="Comment"># Code is provided as is with no warranty. Use it on your own risk.</span><br /><span class="Comment"># Use the source code according GPL3 and distribute the code also with this 3 line header</span><br /><span class="PreProc">import</span> numpy <span class="Statement">as</span> np<br /><span class="Comment">#import matplotlib.pyplot as plt</span><br /><span class="Comment">#import matplotlib as mpl</span><br /><span class="Comment">#mpl.use('Agg')</span><br /><span class="Comment">#import pylab</span><br /><span class="Comment">#import matplotlib.cm as cm</span><br /><span class="PreProc">from</span> PIL <span class="PreProc">import</span> Image<br /><br /><span class="Statement">def</span> <span class="Function">dotplot</span>(s1,s2,win_size,threshold,outfile=<span class="Function">None</span>,outorigfile=<span class="Function">None</span>):<br />    <span class="Function">print</span> <span class="String">'computing dotplot base matrix'</span><br />    m=dotplotArr(s1,s2)<br />    <span class="Function">print</span> <span class="String">'plotting'</span><br />    plotMatplot(m,outorigfile)<br />    <span class="Function">print</span> <span class="String">'computing dotplot slide window matrix'</span><br />    wm=dotplotSlideWinArr(m,win_size, threshold)<br />    <span class="Function">print</span> <span class="String">'plotting'</span><br />    plotMatplot(wm,outfile)<br />    <span class="Statement">return</span> (m,wm)<br /><br /><span class="Statement">def</span> <span class="Function">dotplotArr</span>(s1,s2):<br />    <span class="String">''' Quite dense function dotplot computes 2D array m </span><br /><span class="String">    with size |s1|*|s2| where m[i,j]=1 if s1[i]==s2[j] (intended for strings s1, s2).</span><br /><span class="String">    For understanding the function, see how the diagonal is computed with diagind index.</span><br /><span class="String">    On diagonal is 1 if s1[i]==s2[i]. All 1s on diagonal =&gt; s1==s2.</span><br /><span class="String">    Return 2D array of Booleans stored in one Byte.</span><br /><span class="String">    '''</span><br />    <span class="Statement">if</span> <span class="Function">len</span>(s1)&gt;<span class="Function">len</span>(s2):<br />        s1,s2=s2,s1<br />    <span class="Comment"># |s1| &lt;= |s2|</span><br />    m=np.zeros((<span class="Function">len</span>(s1),<span class="Function">len</span>(s2)),dtype=np.<span class="Function">bool</span>)<br />    <span class="Statement">for</span> i <span class="Statement">in</span> <span class="Function">range</span>(<span class="Function">len</span>(s2)):<br />        shift_s2=s2[i:]+s2[:i]<br />        <span class="Statement">for</span> j <span class="Statement">in</span> <span class="Function">range</span>(<span class="Function">len</span>(s1)):<br />            <span class="Statement">if</span> shift_s2[j]==s1[j]:<br />                diagind=np.mod(i+j,<span class="Function">len</span>(s1))<br />                m[diagind,j]=<span class="Function">True</span><br />    <span class="Statement">return</span> m<br /><br /><span class="Statement">def</span> <span class="Function">dotplotSlideWinArr</span>(m,win_size,threshold):<br />    <span class="String">''' Complexity is O(|m|)=O(|w|*|h|) assuming cumsum takes O(|m|).</span><br /><span class="String">    Return 2D array of numpy.uint16'</span><br /><span class="String">    '''</span><br />    h,w=m.shape<br />    <span class="Statement">assert</span> win_size&lt;=h <span class="Statement">and</span> win_size&lt;=w, <span class="String">'Window is bigger than the basic dotplot array!'</span><br />    <span class="Statement">assert</span> win_size&lt;<span class="Constant">256</span>, <span class="String">'win_size*win_size has to be less that max value of numpy.uint16!'</span><br />    wn=np.zeros( (h-win_size+<span class="Constant">1</span>,w-win_size+<span class="Constant">1</span>), dtype=np.uint16)<br />    h_wn,w_wn=wn.shape<br /><br />    <span class="Comment"># 2 more arrays of size m </span><br />    cumsum_w=np.zeros((h,w),dtype=np.uint64)<br />    cumsum_h=np.zeros((h,w),dtype=np.uint64)<br />    np.cumsum(m,axis=<span class="Constant">1</span>,dtype=np.uint64,out=cumsum_w)<br />    np.cumsum(m,axis=<span class="Constant">0</span>,dtype=np.uint64,out=cumsum_h)<br /><br />    <span class="Comment"># computing wn[0,0]</span><br />    <span class="Statement">for</span> i <span class="Statement">in</span> <span class="Function">range</span>(win_size):<br />        wn[<span class="Constant">0</span>,<span class="Constant">0</span>]+=cumsum_w[i,win_size-<span class="Constant">1</span>]<br />    <span class="Comment"># computing first row wn[0,:]</span><br />    <span class="Statement">for</span> j <span class="Statement">in</span> <span class="Function">range</span>(<span class="Constant">1</span>,w_wn):<br />        wn[<span class="Constant">0</span>,j]=wn[<span class="Constant">0</span>,j-<span class="Constant">1</span>]-cumsum_h[win_size-<span class="Constant">1</span>,j-<span class="Constant">1</span>]+cumsum_h[win_size-<span class="Constant">1</span>,j-<span class="Constant">1</span>+win_size]<br />    <span class="Comment"># computing first column wn[:,0]</span><br />    <span class="Statement">for</span> i <span class="Statement">in</span> <span class="Function">range</span>(<span class="Constant">1</span>,h_wn):<br />        wn[i,<span class="Constant">0</span>]=wn[i-<span class="Constant">1</span>,<span class="Constant">0</span>]-cumsum_w[i-<span class="Constant">1</span>,win_size-<span class="Constant">1</span>]+cumsum_w[i-<span class="Constant">1</span>+win_size,win_size-<span class="Constant">1</span>]<br />    <span class="Comment"># computing the rest </span><br />    <span class="Statement">for</span> i <span class="Statement">in</span> <span class="Function">range</span>(<span class="Constant">1</span>,h_wn):<br />       <span class="Statement">for</span> j <span class="Statement">in</span> <span class="Function">range</span>(<span class="Constant">1</span>,w_wn):<br />           col_before=cumsum_h[i+win_size-<span class="Constant">1</span>,j-<span class="Constant">1</span>]-cumsum_h[i-<span class="Constant">1</span>,j-<span class="Constant">1</span>]<br />           col_after=cumsum_h[i+win_size-<span class="Constant">1</span>,j-<span class="Constant">1</span>+win_size]-cumsum_h[i-<span class="Constant">1</span>,j-<span class="Constant">1</span>+win_size]<br />           wn[i,j]=wn[i,j-<span class="Constant">1</span>]-col_before+col_after<br /><br />    <span class="Comment"># substracting threshold -&gt; interested in values that pass the threshold (otherwise 0)</span><br />    <span class="Statement">for</span> i <span class="Statement">in</span> <span class="Function">range</span>(h_wn):<br />        <span class="Statement">for</span> j <span class="Statement">in</span> <span class="Function">range</span>(w_wn):<br />            wn[i,j]=<span class="Function">max</span>(<span class="Constant">0</span>,wn[i,j]-threshold)<br /><br />    <span class="Statement">return</span> wn<br /><br /><span class="Comment">#def plotMatplot(m,name=None):</span><br /><span class="Comment">#    minm=np.min(m)</span><br /><span class="Comment">#    maxm=np.max(m)</span><br /><span class="Comment">#    fig=plt.figure()</span><br /><span class="Comment">#    ax=fig.add_subplot(111)</span><br /><span class="Comment">#    cax=ax.imshow(m,interpolation='nearest',cmap=cm.gist_gray)</span><br /><span class="Comment">#    cbar = fig.colorbar(cax, ticks=[minm,maxm])</span><br /><span class="Comment">#    cbar.ax.set_yticklabels([str(minm),str(maxm)])</span><br /><span class="Comment">#    if name==None:</span><br /><span class="Comment">#        plt.show()</span><br /><span class="Comment">#        print 'Figure drawned.'</span><br /><span class="Comment">#    else:</span><br /><span class="Comment">#        plt.savefig(name)</span><br /><span class="Comment">#        print 'Figure %s saved ' % name</span><br /><br /><span class="Statement">def</span> <span class="Function">display_PIL</span>(m,name,win_size=<span class="Function">None</span>):<br />    <span class="Statement">if</span> win_size==<span class="Function">None</span>:<br />        maxm=np.<span class="Function">max</span>(m)<br />    <span class="Statement">else</span>:<br />        maxm=win_size*win_size<br />    <span class="Statement">if</span> maxm &gt; <span class="Constant">255</span>:<br />        k=maxm/<span class="Constant">255</span><br />        i=Image.fromarray(np.uint8(m/k))<br />    <span class="Statement">else</span>:<br />        k=<span class="Constant">255</span>/maxm<br />        i=Image.fromarray(np.uint8(m*k))<br />    <span class="Statement">if</span> name==<span class="Function">None</span>:<br />        i.show()<br />    <span class="Statement">else</span>:<br />        i.save(name)<br />        <span class="Function">print</span> <span class="String">'Figure %s saved '</span> % name<br />        <span class="Statement">del</span> i <span class="Comment"># force GC</span><br /><br /><br /><span class="Statement">if</span> __name__==<span class="String">'__main__'</span>:<br />    <span class="Function">print</span> <span class="String">'No tests'</span><br /></pre></body></html>